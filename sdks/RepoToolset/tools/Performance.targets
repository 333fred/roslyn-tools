<?xml version="1.0" encoding="utf-8"?>
<!-- Copyright (c)  Microsoft.  All Rights Reserved.  Licensed under the Apache License, Version 2.0.  See License.txt in the project root for license information. -->
<Project>

  <PropertyGroup>
    <MSBuildAllProjects>$(MSBuildAllProjects);$(MSBuildThisFileFullPath)</MSBuildAllProjects>
  </PropertyGroup>

  <!-- The 'PerformanceTest' target is only viable for repos building their own performance-test harness. -->
  <Target Name="PerformanceTest" Condition="'$(IsPerformanceTestProject)' == 'true'">

    <MakeDir Directories="$(ArtifactsTestResultsDir)"/>
    <Message Text="Running performance tests: $(TargetPath)" Importance="high"/>
    
    <!-- Call the repo built performance-test harness directly with the necessary parameters. -->
    <Exec Command='"$(DotNetTool)" "$(TargetPath)" $(PerformanceTestParameters)'
          LogStandardErrorAsError="false"
          WorkingDirectory="$(OutDir)"
          IgnoreExitCode="true">

      <Output TaskParameter="ExitCode" PropertyName="_TestErrorCode" />
    </Exec>
  </Target>

</Project>
